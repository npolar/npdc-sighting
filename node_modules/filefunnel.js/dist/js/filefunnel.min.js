!function(){"use strict";function e(e,t){return"string"==typeof e?(t||document).querySelector(e):null}function t(e,t){return[].slice.call((t||document).querySelectorAll(e))}function n(t,s){if(t instanceof n)return t;if(t instanceof HTMLElement&&!(this instanceof n))return new n(t,s);if(!(this instanceof n))return(t=e(t,s instanceof n?s.dom:s))?new n(t):null;s=Object.assign({appendTo:null,context:document,html:"",insertAfter:null,insertBefore:null,replace:null},s);var i,o,r=t instanceof HTMLElement?t:null;if("string"==typeof t){o=function(e,t){return e.match(/(\[[^\]]+\]|#[^#.\[]+|\.[^#.\[]+|\w+)/g).forEach(function(e){"["==e[0]?(e=e.match(/^\[([^=\]]+)=?([^\]]+)?\]$/))&&(t.attribs[e[1]]=e[2]||""):"."==e[0]?t.classes.push(e.substr(1)):"#"==e[0]?t.attribs.id=e.substr(1):t.tag=e}),t}(t,{attribs:{},classes:[]}),r=s.context.createElement(o.tag),o.classes.forEach(function(e){r.classList.add(e)});for(i in o.attribs)o.attribs.hasOwnProperty(i)&&r.setAttribute(i,o.attribs[i])}this.events={},this.dom=t instanceof HTMLElement?t:r,this.parent=t instanceof HTMLElement?n(t.parentElement):null,s.html&&r&&(r.innerHTML=s.html),(i=n(s.replace))?i.parent.replace(i,this):(i=n(s.appendTo))?i.append(this):(i=n(s.insertAfter))?i.parent.append(this,i):(i=n(s.insertBefore))&&i.parent.insert(this,i);var a=this.dom,l={add:function(){return[].slice.call(arguments).forEach(function(e){a.setAttribute(e,"")}),a.attributes},get:function(e){return a.getAttribute(arg)},remove:function(){return[].slice.call(arguments).forEach(function(e){a.removeAttribute(e)}),a.attributes},set:function(e,t){return a.setAttribute(e,t),a.attributes}};for(var u in l)a.attributes[u]=l[u]}function s(e,t){return this._callbacks={},this._elements={},this._i18n={},this._parent=n(e),this._options=Object.assign({accept:"*/*",autoResize:!0,auth:null,chunked:!1,chunkSize:1048576,className:"filefunnel",credentials:!1,emptyNames:!1,headers:{},maxSize:1/0,multiple:!1,progress:!1},t),this.files=[],this.locale=this._options.locale||(navigator?(navigator.userLanguage||navigator.language).replace("-","_"):null),this.status=s.status.NONE,this.build()}return"function"!=typeof Object.assign&&(Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");var t,n,s,i=Object(e);for(t=1;t<arguments.length;++t)if(void 0!==(n=arguments[t])&&null!==n)for(s in n)n.hasOwnProperty(s)&&(i[s]=n[s]);return i}),n.prototype={add:function(e){return(e instanceof Array?e:[e]).forEach(function(e){(e=n(e))&&(this.dom.appendChild(e.dom),e.parent=this)},this),this},append:function(e,t){return(t=this.child(t))?this.dom.insertBefore(n(e).dom,t.dom.nextElementSibling):this.dom.appendChild(n(e).dom),e instanceof n&&(e.parent=this),this},get attribs(){return this.dom.attributes},child:function(s){if("string"==typeof s){var i,o,r,a,l=this.dom;if(s.split(" ").forEach(function(t,n,s){l&&n<s.length-1&&(l=e(t,l))}),l){o=[].slice.call(l.children),a=t(s,l);for(r in a)for(i in o)if(a[r]===o[i])return n(o[i])}}else{if(s instanceof n)return s.dom.parentElement===this.dom?s:null;if(s instanceof HTMLElement)return s.parentElement===this.dom?n(s):null}return null},get classes(){return this.dom.classList},clear:function(){for(var e,t=this.dom;e=t.firstChild;)t.removeChild(e);return this},get enabled(){return!this.dom.hasAttribute("disabled")},set enabled(e){return e?this.dom.removeAttribute("disabled"):this.dom.setAttribute("disabled",""),this.enabled},focus:function(){this.dom.focus(),this.dom.selectionStart=this.value.length},get html(){return this.dom.innerHTML},set html(e){return this.dom.innerHTML=e},insert:function(e,t){return this.dom.insertBefore(n(e).dom,(t=this.child(t))?t.dom:this.dom.firstElementChild),e instanceof n&&(e.parent=this),this},on:function(e,t,n){return(e instanceof Array?e:[e]).forEach(function(e){if("string"==typeof e){var s=this,i="function"==typeof t?function(e){return t.call(n||s,e)}:null;s.events[e]instanceof Array||(s.events[e]=[]),i?(s.events[e].push(i),s.dom.addEventListener(e,i)):s.events[e].forEach(function(t,n,i){s.dom.removeEventListener(e,t),i.splice(n,1)})}},this),this},remove:function(e){(e=n(e))&&this.dom.removeChild(e.dom)},replace:function(e,t){return(t=new n(t))&&(e=n(e,this))&&(this.dom.replaceChild(t.dom,e.dom),t.parent=this,e.parent=null),this},get value(){return void 0!==this.dom.value?this.dom.value:this.html},set value(e){return void 0!==this.dom.value?this.dom.value=e:this.html=e},get visible(){return!this.dom.hasAttribute("hidden")},set visible(e){return e?this.dom.removeAttribute("hidden"):this.dom.setAttribute("hidden",""),this.visible}},s.VERSION=.81,s.status={NONE:0,READY:1,UPLOADING:2,COMPLETED:3,ABORTED:4,FAILED:5},s.prototype={abort:function(){this._elements.resetButton&&this._elements.resetButton.dom.click()},get auth(){return this._options.auth},set auth(e){return this._options.auth="string"==typeof e?e:null},browse:function(){this._elements.fileInput&&this._elements.fileInput.dom.click()},build:function(){var e=this,t=e.files,i=e._i18n,o=e._options,r=e._parent,a=("string"==typeof o.accept?o.accept:"*/*").replace(/[\[\]#\s]/g,"").split(","),l={form:new n("form[enctype=multipart/form-data][method=POST]."+o.className),browseButton:new n("input[type=button][value="+(o.multiple?i.add:i.browse)+"].browse"),fileInput:new n("input[type=file][accept="+a.join(",")+"][hidden][multiple]"),fileList:new n("div.filelist"),submitButton:new n("input[type=submit][value="+i.upload+"][disabled].submit"),resetButton:new n("input[type=reset][value="+i.reset+"].reset")},u={401:i.forbidden,403:i.forbidden,409:i.exists,412:i.invalidName,413:i.oversized,415:i.unsupported};return!0!==o.multiple&&l.fileInput.dom.removeAttribute("multiple"),l.form.add([l.browseButton,l.fileInput,l.fileList,l.submitButton,l.resetButton]),r&&(e._elements.form&&e._elements.form.parent?e._elements.form.parent.replace(e._elements.form,l.form):r.dom instanceof HTMLInputElement?(r.parent.append(l.form,r),l.form.classes.add("widget"),e._elements=l,e.hide().resize(),r.on("click",function(){e.toggle()}),document.addEventListener("click",function(t,n){if(l.form.visible){for(;n=n?n.parentNode:t.target;)if(n==l.form.dom||n==r.dom)return;e.hide()}}),window.addEventListener("resize",function(){!0===o.autoResize&&e.resize()})):r.append(l.form)),e._elements=l,l.browseButton.on("click",function(){l.fileInput.dom.click()}),l.fileInput.on("change",function(r){o.multiple||(t.length=0,l.fileList.clear()),[].slice.call(r.target.files).forEach(function(r){function u(e){var t=e.match(/^([^\/]+)\/(.*)$/);return function(n){return n==e||t&&n==t[1]+"/*"||"*/*"==n}}for(var r,c,f=r.size,d=r.lastModifiedDate,m={},p=0;p<t.length;++p)if((c=t[p].reference).name==r.name&&c.lastModifiedDate.valueOf()==d.valueOf())return;f=f>=1073741824?(f/1073741824).toFixed(2)+i.gibiBytes:f>=1048576?(f/1048576).toFixed(2)+i.mebiBytes:f>=1024?(f/1024).toFixed(2)+i.kibiBytes:f+=i.bytes,l.fileList.add(new n("fieldset.fileinfo").append(new n("legend",{html:r.name})).append(m.name=new n("input[type=text].name")).append(m.size=new n("input[type=text][disabled].size")).append(m.type=new n("input[type=text][disabled].type")).append(m.prog=new n("progress[value=0].progress")).append(m.info=new n("span.info"))),m.name.attribs.set("placeholder",i.fileName).set("value",r.name),m.size.attribs.set("placeholder",i.fileSize).set("value",f),m.type.attribs.set("placeholder",i.fileType).set("value",r.type),o.emptyNames||m.name.on(["input","change"],function(e){e.target.value||s.status.READY!=r.status?i.invalidName==r.elements.info.value&&(r.status=s.status.READY,r.elements.info.classes.remove("error"),r.elements.info.value=""):(r.status=s.status.ABORTED,r.elements.info.classes.add("error"),r.elements.info.value=i.invalidName),l.submitButton.enabled=t.some(function(e){return s.status.READY==e.status})}),t.push(r={bytesSent:0,bytesTotal:r.size,elements:m,location:null,parent:e,reference:r,response:null,status:s.status.READY,xhr:null,get progress(){return s.status.UPLOADING==this.status?Math.round(this.bytesSent/this.bytesTotal*100):NaN}}),r.reference.size>o.maxSize?(r.status=s.status.ABORTED,r.elements.info.classes.add("error"),r.elements.info.value=i.oversized):a.some(u(r.reference.type))||(r.status=s.status.ABORTED,r.elements.info.classes.add("error"),r.elements.info.value=i.unsupported)}),e.status=t.length?s.status.READY:s.status.NONE,l.submitButton.enabled=t.some(function(e){return s.status.READY==e.status})}),l.form.on("submit",function(t){t.preventDefault(),e.upload()}),e.upload=function(){function n(n){for(var o in t)if(s.status.UPLOADING==t[o].status)return;l.resetButton.on("click",null),l.resetButton.value=i.reset,e.status=s.status.COMPLETED}if(l.browseButton.enabled=l.submitButton.enabled=!1,l.resetButton.value=i.cancel,e.status=s.status.UPLOADING,"string"==typeof o.auth&&(o.credentials=!0,o.headers=Object.assign({Authorization:o.auth},o.headers)),l.resetButton.on("click",function(e){if(e.preventDefault(),o.chunked)for(var n in t)t[n].xhr instanceof XMLHttpRequest&&t[n].xhr.abort();else t.xhr instanceof XMLHttpRequest&&t.xhr.abort()}),o.chunked){var r="number"==typeof o.chunkSize?o.chunkSize:1048576;t.forEach(function(t){if(t.status==s.status.READY){var a=t.elements.name.value,l=function(){var c=t.reference.slice(t.bytesSent,Math.min(t.bytesTotal,t.bytesSent+r)+1,t.reference.type),f=t.xhr=new XMLHttpRequest;f.onloadstart=function(n){t.status=s.status.UPLOADING,"function"==typeof e._callbacks.start&&e._callbacks.start(t)},f.upload.onprogress=function(n){n.lengthComputable&&(t.elements.prog.value=t.bytesSent+n.loaded),t.bytesSent+n.loaded>=t.bytesTotal&&(t.elements.info.value=i.processing),"function"==typeof e._callbacks.progress&&e._callbacks.progress(t)},f.onload=function(o){var r=o.target.status;if(r>=200&&300>r){if(t.elements.prog.attribs.set("max",t.bytesTotal).set("value",t.bytesSent+=c.size),t.bytesSent<t.bytesTotal)return"function"==typeof l&&l();t.status=s.status.COMPLETED,t.elements.info.classes.add("success"),t.elements.info.value=i.success,n(t),201==r&&(t.location=f.getResponseHeader("Content-Location")||null,t.response=f.responseText||null),"function"==typeof e._callbacks.success&&e._callbacks.success(t)}else r>=400&&(t.status=s.status.FAILED,t.elements.info.classes.add("error"),t.elements.info.value=u[r]||i.failed,n(t),"function"==typeof e._callbacks.error&&e._callbacks.error(t))},f.onabort=function(){t.status=s.status.ABORTED,t.elements.info.value=i.aborted,n(t),"function"==typeof e._callbacks.abort&&e._callbacks.abort(t)},f.ontimeout=function(){t.status=s.status.FAILED,t.elements.info.classes.add("error"),t.elements.info.value=i.timeout,n(t),"function"==typeof e._callbacks.error&&e._callbacks.error(t)},f.onerror=function(){t.status=s.status.FAILED,t.elements.info.classes.add("error"),t.elements.info.value=i.refused,n(t),"function"==typeof e._callbacks.error&&e._callbacks.error(t)};var d,m=Object.assign({"Content-Type":c.type,"X-File-Name":a,"X-File-Size":t.bytesTotal},o.headers);f.open("POST",o.server,!0),f.withCredentials=o.credentials===!0;for(d in m)f.setRequestHeader(d,m[d]);f.send(c)};t.elements.prog.attribs.set("max",t.bytesTotal),l()}})}else{var a,c=t.xhr=new XMLHttpRequest,f=new FormData,d=0,m=0;c.onloadstart=function(n){t.forEach(function(t){s.status.READY==t.status&&(t.status=s.status.UPLOADING,t.elements.prog.attribs.remove("max","value"),"function"==typeof e._callbacks.start&&e._callbacks.start(t))})},o.progress&&(c.upload.onprogress=function(n){n.lengthComputable&&(a=t[d])&&s.status.UPLOADING==a.status&&(a.elements.prog.attribs.set("max",a.bytesTotal).set("value",a.bytesSent=Math.min(a.bytesTotal,n.loaded-m)),a.bytesSent>=a.bytesTotal&&(++d,m+=a.bytesTotal,a.elements.info.value=i.processing),"function"==typeof e._callbacks.progress&&e._callbacks.progress(a))}),c.onload=function(o){var r=o.target.status;t.forEach(function(t){s.status.UPLOADING==t.status&&(r>=200&&300>r?(t.status=s.status.COMPLETED,t.elements.prog.attribs.set("max",1).set("value",1),t.elements.info.classes.add("success"),t.elements.info.value=u[r]||i.success,n(t),"function"==typeof e._callbacks.success&&e._callbacks.success(t)):r>=400&&(t.status=s.status.FAILED,t.elements.prog.attribs.set("max",1).set("value",0),t.elements.info.classes.add("error"),t.elements.info.value=u[r]||i.failed,n(t),"function"==typeof e._callbacks.error&&e._callbacks.error(t)))})},c.onabort=function(){t.forEach(function(t){t.status=s.status.ABORTED,t.elements.prog.attribs.set("max",1).set("value",0),t.elements.info.value=i.aborted,n(t),"function"==typeof e._callbacks.abort&&e._callbacks.abort(t)})},c.ontimeout=function(){t.forEach(function(t){t.status=s.status.FAILED,t.elements.prog.attribs.set("max",1).set("value",0),t.elements.info.classes.add("error"),t.elements.info.value=i.timeout,n(t),"function"==typeof e._callbacks.error&&e._callbacks.error(t)})},c.onerror=function(o){t.forEach(function(t){t.status=s.status.FAILED,t.elements.prog.attribs.set("max",1).set("value",0),t.elements.info.classes.add("error"),t.elements.info.value=i.refused,n(t),"function"==typeof e._callbacks.error&&e._callbacks.error(t)})},t.forEach(function(e){e.status==s.status.READY&&(f.append(e.reference.name,e.reference,e.elements.name.value),e.elements.prog.dom.removeAttribute("value"))});var p,b=o.headers;c.open("POST",o.server,!0),c.withCredentials=o.credentials===!0;for(var p in b)c.setRequestHeader(p,b[p]);c.send(f)}},l.form.on("reset",function(){t.length=0,l.fileList.clear(),l.browseButton.enabled=!0,l.submitButton.enabled=!1,l.resetButton.value=i.reset,e.status=s.status.NONE}),this},get element(){return this._parent?this._parent.dom:null},get headers(){return this._options.headers},hide:function(){return this._elements.form&&(this._elements.form.visible=!1),this},get locale(){return this._i18n._id},set locale(e){return(this._i18n=Object.assign({_id:s.i18n[e]?e:"en_GB"},s.i18n.en_GB,s.i18n[e]))._id},on:function(e,t){return(e instanceof Array?e:[e]).forEach(function(e){if(-1==["start","progress","success","abort","error"].indexOf(e))throw"Unrecognized FileFunnel event: "+e;this._callbacks[e]="function"==typeof t?t:null},this),this},reset:function(){this._elements.form&&this._elements.form.dom.reset()},resize:function(e){return this._elements.form&&this._parent&&(this._elements.form.dom.style.width=(isNaN(e=Number(e))?this._parent.dom.offsetWidth:e)+"px"),this},get server(){return"string"==typeof this._options.server?this._options.server:null},set server(e){return this._options.server="string"==typeof e?e:null},show:function(){return this._elements.form&&(this._elements.form.visible=!0),this},toggle:function(){return this._elements.form&&(this._elements.form.visible=!this._elements.form.visible),this},upload:function(){}},s.i18n={en_GB:{add:"Add files",browse:"Choose file",cancel:"Cancel","delete":"Delete",reset:"Reset",upload:"Upload",bytes:" bytes",gibiBytes:" GiB",kibiBytes:" KiB",mebiBytes:" MiB",fileName:"Filename",fileSize:"Unknown size",fileType:"Unrecognised filetype",aborted:"Upload aborted",exists:"File already exists",failed:"Upload failed",forbidden:"Unauthorised for upload",invalidName:"Invalid filename",oversized:"File too big for upload",processing:"Processing, please wait...",refused:"Connection refused",success:"Upload successful",timeout:"Upload timed out",unsupported:"Unsupported filetype"}},"undefined"!=typeof window&&(window.FileFunnel=s),"object"==typeof module&&module.exports&&(module.exports=s),s}();